#include <stdio.h>
#include <math.h>

/* --- prototypes --- */
int isPrime(int x);
void listPrimesLessThan(int n);
void listFirstNSquares(int n);
int isPerfect(int x);
int countPerfectsLessThan(int n);

int main(void) {
    int choice;
    int n;

    printf("Chon bai (1: C5.89, 2: C5.90, 3: C5.91): ");
    if (scanf("%d", &choice) != 1) return 0;

    printf("Nhap so nguyen duong n (n > 0): ");
    if (scanf("%d", &n) != 1 || n <= 0) {
        printf("Gia tri n khong hop le.\n");
        return 0;
    }

    switch (choice) {
        case 1:
            printf("Cac so nguyen to nho hon %d:\n", n);
            listPrimesLessThan(n);
            break;
        case 2:
            printf("%d so chinh phuong dau tien:\n", n);
            listFirstNSquares(n);
            break;
        case 3: {
            int cnt = countPerfectsLessThan(n);
            printf("Co %d so hoan thien nho hon %d\n", cnt, n);
            break;
        }
        default:
            printf("Lua chon khong hop le.\n");
    }

    return 0;
}

/* --- ham kiem tra so nguyen to --- */
int isPrime(int x) {
    if (x < 2) return 0;
    if (x == 2) return 1;
    if (x % 2 == 0) return 0;
    int r = (int)sqrt((double)x);
    for (int i = 3; i <= r; i += 2) {
        if (x % i == 0) return 0;
    }
    return 1;
}

/* C5.89: Liet ke tat ca so nguyen to nho hon n */
void listPrimesLessThan(int n) {
    int first = 1;
    for (int i = 2; i < n; ++i) {
        if (isPrime(i)) {
            if (!first) printf(" ");
            printf("%d", i);
            first = 0;
        }
    }
    if (first) printf("(khong co)");
    printf("\n");
}

/* C5.90: Liet ke n so chinh phuong dau tien */
void listFirstNSquares(int n) {
    for (int i = 1; i <= n; ++i) {
        printf("%d", i * i);
        if (i < n) printf(" ");
    }
    printf("\n");
}

/* ham kiem tra so hoan thien */
int isPerfect(int x) {
    if (x <= 1) return 0;
    int sum = 1; /* 1 luon la uoc */
    int r = (int)sqrt((double)x);
    for (int i = 2; i <= r; ++i) {
        if (x % i == 0) {
            sum += i;
            int other = x / i;
            if (other != i) sum += other;
        }
    }
    return sum == x;
}

/* C5.91: Dem so hoan thien nho hon n */
int countPerfectsLessThan(int n) {
    int cnt = 0;
    for (int i = 2; i < n; ++i) {
        if (isPerfect(i)) ++cnt;
    }
    return cnt;
}
